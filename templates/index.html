<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>グリッド動画生成ツール</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>グリッド動画生成ツール</h1>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <div class="flash-messages">
                    {% for message in messages %}
                        <div class="alert">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        <div class="row">
            <div class="col-left">
                <section class="upload-section">
                    <h2>画像アップロード</h2>
                    <div class="upload-container">
                        <form method="POST" action="{{ url_for('upload_file') }}" enctype="multipart/form-data" class="upload-form">
                            <div class="file-input-container">
                                <label for="file-upload" class="custom-file-upload">
                                    ファイルを選択
                                </label>
                                <input id="file-upload" type="file" name="files[]" multiple accept=".jpg,.jpeg">
                                <span id="file-count">選択されていません</span>
                            </div>
                            <button type="submit" class="btn btn-primary">アップロード</button>
                        </form>
                    </div>
                    
                    <div class="uploaded-files">
                        <h3>アップロード済み画像 ({{ files|length }}枚)</h3>
                        {% if files %}
                            <div class="image-grid">
                                {% for file in files %}
                                    <div class="image-item">
                                        <img src="{{ url_for('preview_image', filename=file) }}" alt="{{ file }}">
                                        <span class="image-name">{{ file }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                            <form method="POST" action="{{ url_for('clear_files') }}">
                                <button type="submit" class="btn btn-danger btn-sm">全ての画像を削除</button>
                            </form>
                        {% else %}
                            <p class="no-files">アップロードされた画像はありません</p>
                        {% endif %}
                    </div>
                </section>
            </div>
            
            <div class="col-right">
                <section class="generate-section">
                    <h2>動画生成</h2>
                    <form method="POST" action="{{ url_for('generate_video') }}" class="generate-form">
                        <div class="settings-grid">
                            <div class="form-group">
                                <label for="GRID_ROWS">行数</label>
                                <input type="number" name="GRID_ROWS" id="GRID_ROWS" value="6" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label for="GRID_COLS">列数</label>
                                <input type="number" name="GRID_COLS" id="GRID_COLS" value="6" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label for="IMAGE_HEIGHT">画像の高さ(px)</label>
                                <input type="number" name="IMAGE_HEIGHT" id="IMAGE_HEIGHT" value="100" min="50" max="500">
                            </div>
                            <div class="form-group">
                                <label for="ANIMATION_DURATION">アニメーション時間(秒)</label>
                                <input type="number" name="ANIMATION_DURATION" id="ANIMATION_DURATION" value="4" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label for="FPS">フレームレート</label>
                                <input type="number" name="FPS" id="FPS" value="30" min="15" max="60">
                            </div>
                            <div class="form-group">
                                <label for="BACKGROUND_COLOR">背景色</label>
                                <select name="BACKGROUND_COLOR" id="BACKGROUND_COLOR">
                                    <option value="white">白</option>
                                    <option value="black">黒</option>
                                    <option value="red">赤</option>
                                    <option value="green">緑</option>
                                    <option value="blue">青</option>
                                    <option value="255,255,255">カスタム白</option>
                                    <option value="0,0,0">カスタム黒</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="CROP_POSITION">クロップ位置</label>
                                <select name="CROP_POSITION" id="CROP_POSITION">
                                    <option value="center">中央</option>
                                    <option value="top">上</option>
                                    <option value="bottom">下</option>
                                    <option value="left">左</option>
                                    <option value="right">右</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="GAP_HORIZONTAL">水平方向の間隔(px)</label>
                                <input type="number" name="GAP_HORIZONTAL" id="GAP_HORIZONTAL" value="0" min="0" max="50">
                            </div>
                            <div class="form-group">
                                <label for="GAP_VERTICAL">垂直方向の間隔(px)</label>
                                <input type="number" name="GAP_VERTICAL" id="GAP_VERTICAL" value="0" min="0" max="50">
                            </div>
                            <div class="form-group">
                                <label for="ASPECT_RATIO_W">アスペクト比(幅)</label>
                                <input type="number" name="ASPECT_RATIO_W" id="ASPECT_RATIO_W" value="4" min="1" max="16">
                            </div>
                            <div class="form-group">
                                <label for="ASPECT_RATIO_H">アスペクト比(高さ)</label>
                                <input type="number" name="ASPECT_RATIO_H" id="ASPECT_RATIO_H" value="3" min="1" max="16">
                            </div>
                        </div>
                        <div class="form-submit">
                            <button type="submit" class="btn btn-generate">動画を生成</button>
                        </div>
                    </form>
                </section>
            </div>
        </div>
        
        <section class="output-section">
            <h2>生成された動画</h2>
            {% if output_files %}
                <div class="video-container">
                    {% for file in output_files %}
                        <div class="video-item">
                            <video controls>
                                <source src="{{ url_for('serve_video', filename=file) }}" type="video/mp4">
                                お使いのブラウザはビデオタグをサポートしていません。
                            </video>
                            <div class="video-actions">
                                <span class="video-name">{{ file }}</span>
                                <a href="{{ url_for('download_file', filename=file) }}" class="btn btn-download">ダウンロード</a>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <p class="no-files">生成された動画はありません</p>
            {% endif %}
        </section>
    </div>
    
    <script>
        // ファイル選択時のUI更新
        document.getElementById('file-upload').addEventListener('change', function(e) {
            const fileCount = e.target.files.length;
            document.getElementById('file-count').textContent = 
                fileCount > 0 ? `${fileCount}ファイル選択中` : '選択されていません';
        });
    </script>
</body>
</html> 